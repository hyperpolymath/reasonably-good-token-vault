# SPDX-License-Identifier: AGPL-3.0-or-later
# SPDX-FileCopyrightText: 2025 Hyperpolymath
#
# AirVPN Configuration for Svalinn Vault
#
# Security requirements:
# - IPv6 only (dual-stack disabled)
# - Kill switch enabled
# - DNS leak protection
# - Network lock (prevent traffic outside VPN)

[Interface]
# WireGuard interface for AirVPN
PrivateKey = ${AIRVPN_PRIVATE_KEY}
Address = ${AIRVPN_IPV6_ADDRESS}/128
DNS = 2001:41d0:801:2000::a193
MTU = 1320

# Post-up: Enable network lock and IPv4 blocking
PostUp = ip6tables -I OUTPUT ! -o %i -m mark ! --mark $(wg show %i fwmark) -m addrtype ! --dst-type LOCAL -j REJECT
PostUp = iptables -P OUTPUT DROP
PostUp = iptables -P INPUT DROP
PostUp = iptables -P FORWARD DROP
PostUp = sysctl -w net.ipv6.conf.all.disable_ipv6=0
PostUp = sysctl -w net.ipv4.conf.all.disable_ipv4=1

# Post-down: Restore (but keep IPv4 blocked for safety)
PostDown = ip6tables -D OUTPUT ! -o %i -m mark ! --mark $(wg show %i fwmark) -m addrtype ! --dst-type LOCAL -j REJECT

[Peer]
# AirVPN Server (IPv6 only endpoint)
PublicKey = ${AIRVPN_SERVER_PUBLIC_KEY}
PresharedKey = ${AIRVPN_PRESHARED_KEY}
AllowedIPs = ::/0
Endpoint = ${AIRVPN_IPV6_ENDPOINT}:1637
PersistentKeepalive = 15
