# SPDX-License-Identifier: AGPL-3.0-or-later
# SPDX-FileCopyrightText: 2025 Hyperpolymath
#
# GitHub Repository Settings - MAXIMUM SECURITY
#
# Requires: github-settings app or probot/settings
# Apply with: Settings -> Branches -> Branch protection rules

repository:
  name: reasonable-good-token-vault
  description: "Svalinn Secure Identity Vault - Post-quantum cryptography for SSH/PGP/PAT/API credentials"
  homepage: https://hyperpolymath.github.io/reasonable-good-token-vault
  private: false
  has_issues: true
  has_projects: false
  has_wiki: false
  has_downloads: false
  has_discussions: true
  default_branch: main
  allow_squash_merge: true
  allow_merge_commit: false
  allow_rebase_merge: false
  allow_auto_merge: false
  delete_branch_on_merge: true
  allow_update_branch: false

  # Security settings
  security:
    # Enable vulnerability alerts
    enableVulnerabilityAlerts: true
    # Enable automated security fixes
    enableAutomatedSecurityFixes: true

# Branch protection - MAXIMUM LOCKDOWN
branches:
  - name: main
    protection:
      # Require pull request before merging
      required_pull_request_reviews:
        dismiss_stale_reviews: true
        require_code_owner_reviews: true
        required_approving_review_count: 2
        require_last_push_approval: true

      # Require status checks
      required_status_checks:
        strict: true
        contexts:
          - "security/codeql"
          - "security/dependency-review"
          - "security/secret-scanning"
          - "build/rust"
          - "build/ada"
          - "test/unit"
          - "test/integration"
          - "lint/clippy"
          - "lint/format"
          - "validation/echidna"

      # Require signed commits
      required_signatures: true

      # Enforce for administrators too
      enforce_admins: true

      # Restrict who can push
      restrictions:
        users: []
        teams:
          - maintainers
        apps: []

      # Require linear history
      required_linear_history: true

      # Allow force pushes: NEVER
      allow_force_pushes: false

      # Allow deletions: NEVER
      allow_deletions: false

      # Require conversation resolution
      required_conversation_resolution: true

      # Lock branch
      lock_branch: false  # Set to true for full lockdown

      # Block creations
      block_creations: false

  # Protect all branches matching pattern
  - name: "release/*"
    protection:
      required_pull_request_reviews:
        dismiss_stale_reviews: true
        require_code_owner_reviews: true
        required_approving_review_count: 2
      required_signatures: true
      enforce_admins: true
      allow_force_pushes: false
      allow_deletions: false

  - name: "hotfix/*"
    protection:
      required_pull_request_reviews:
        required_approving_review_count: 1
      required_signatures: true
      allow_force_pushes: false
      allow_deletions: false

# Labels
labels:
  - name: security
    color: "d73a4a"
    description: "Security-related issue or PR"
  - name: critical
    color: "b60205"
    description: "Critical priority"
  - name: crypto
    color: "5319e7"
    description: "Cryptography-related"
  - name: post-quantum
    color: "0e8a16"
    description: "Post-quantum cryptography"
  - name: breaking
    color: "d93f0b"
    description: "Breaking change"

# Collaborators - minimal access
collaborators: []

# Teams
teams:
  - name: maintainers
    permission: maintain
  - name: security-team
    permission: triage
