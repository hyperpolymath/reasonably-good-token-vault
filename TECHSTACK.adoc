// SPDX-License-Identifier: MPL-2.0-or-later
// SPDX-FileCopyrightText: 2025 Jonathan D.A. Jewell
= Svalinn Vault Technical Stack
:toc: preamble
:toclevels: 4
:icons: font

Complete technical stack documentation for Svalinn Vault.

== Programming Languages

[cols="1,2,3"]
|===
|Language |Version |Purpose

|*ATS* (Applied Type System)
|0.4.2+
|Core vault implementation with dependent types for compile-time security verification

|*Zig*
|0.11.0+
|Low-level cryptographic bindings (replacing C), cross-compilation to Android

|*Idris2*
|0.6.0+
|IPv6 packet coalescing with metamorphic BGP triggers

|*Guile Scheme*
|3.0+
|Data storage format (USERMEMORY.scm), configuration (ddraig-ssg)

|*Nickel*
|1.0+
|Declarative configuration (config.nickel, cadre-router)

|*Ada*
|GNAT 2023+
|*Legacy* - superseded by ATS CLI/TUI

|*ReScript*
|11.0+
|Type-safe web bindings for JavaScript interop
|===

=== Languages NOT Used

[cols="1,2"]
|===
|Banned |Replacement

|C |Zig
|C++ |Zig
|Rust |ATS (for this project - Rust is allowed in RSR)
|TypeScript |ReScript
|JavaScript |ReScript
|Go |Not applicable
|Python |Not applicable
|Java/Kotlin |Zig (Android)
|Swift |Not applicable
|===

== Cryptographic Algorithms

=== Post-Quantum

[cols="1,1,2"]
|===
|Algorithm |Standard |Purpose

|*ML-KEM (Kyber-1024)*
|NIST FIPS 203
|Key encapsulation mechanism, NIST Level 5

|*ML-DSA (Dilithium5)*
|NIST FIPS 204
|Digital signatures, NIST Level 5
|===

=== Classical

[cols="1,1,2"]
|===
|Algorithm |Standard |Purpose

|*Ed448*
|RFC 8032
|Edwards curve signatures (448-bit)

|*Ed25519*
|RFC 8032
|Edwards curve signatures (256-bit)

|*X25519*
|RFC 7748
|ECDH key agreement

|*AES-256-GCM*
|NIST SP 800-38D
|Authenticated encryption

|*BLAKE3*
|BLAKE3 spec
|Fast hashing, key derivation, MAC

|*SHAKE3-256*
|NIST FIPS 202
|Extendable output function

|*Argon2id*
|RFC 9106
|Memory-hard password hashing (64 MiB)
|===

=== Banned Algorithms

- MD5 (broken)
- SHA-1 (broken)
- DES/3DES (obsolete)
- RC4 (broken)
- RSA < 3072 bits (weak)

== Databases & Storage

[cols="1,2,2"]
|===
|Component |Technology |Purpose

|*Primary Store*
|CUBS
|Flat GUID-based credential storage

|*Search Index*
|XTDB
|Bitemporal queries on GUIDs, agrep fuzzy matching

|*Cache*
|Dragonfly
|High-performance session caching (encrypted values)

|*Format*
|S-expressions (Scheme)
|Data serialization - NO YAML, NO TOML, NO JSON, NO XML
|===

== Container & Isolation

[cols="1,2,2"]
|===
|Component |Technology |Purpose

|*Container Runtime*
|Podman
|OCI container execution (Docker compatible)

|*Base Image*
|Fedora CoreOS
|Immutable, auto-updating base

|*SELinux*
|Type Enforcement
|`svalinn_t` confined domain

|*Isolation*
|Chroot + namespaces
|Filesystem isolation with chmod 000

|*Architecture*
|Dual-container
|Data container + Delivery container, API socket only
|===

== Network Stack

[cols="1,2,2"]
|===
|Component |Technology |Purpose

|*IP Version*
|IPv6 only
|Complete IPv4 lockdown

|*VPN*
|WireGuard (AirVPN)
|Encrypted tunnel with SDP

|*Firewall*
|firewalld
|DROP default policy, svalinn zone

|*Honeypots*
|Custom IPv4
|Ports 22, 23, 80, 443, 3306, 3389, 5432, 5900, 6379, 27017

|*DNS*
|DNSSEC + DoH
|dns-fluctuator for HINFO/LOC rotation

|*Routing*
|Cadre Router
|LAN protection, header stripping, TLS 1.3 only
|===

== Protocols

[cols="1,2,2"]
|===
|Protocol |Version/Variant |Purpose

|*TLS*
|1.3 only
|Transport encryption (no 1.2 fallback)

|*WireGuard*
|Latest
|VPN protocol

|*BEBP*
|Custom
|Data transmission protocol

|*Unix Domain Socket*
|Stream
|Inter-container communication (API only)

|*SSH*
|OpenSSH 9.0+
|Key storage format support
|===

== Build & Package Management

[cols="1,2,2"]
|===
|Tool |Purpose |Config File

|*Nix*
|Reproducible builds
|`flake.nix`

|*Guix*
|Alternative reproducible builds
|`guix.scm`

|*Just*
|Task automation
|`Justfile`

|*Mustfile*
|Requirement validation
|`Mustfile`

|*Zig Build*
|Native compilation
|`build.zig`

|*ATS Make*
|ATS compilation
|`Makefile`
|===

== Distribution Packaging

[cols="1,2"]
|===
|Format |File Location

|Debian (.deb)
|`packaging/debian/`

|RPM (.rpm)
|`packaging/rpm/svalinn-vault.spec`

|Arch (PKGBUILD)
|`packaging/arch/PKGBUILD`

|Flatpak
|`packaging/flatpak/io.github.hyperpolymath.svalinn.yml`

|Scoop (Windows)
|`packaging/windows/scoop/svalinn-vault.json`

|Chocolatey (Windows)
|`packaging/windows/chocolatey/svalinn-vault.nuspec`

|Winget (Windows)
|`packaging/windows/winget/svalinn-vault.yaml`

|MacPorts
|`packaging/macos/macports/Portfile`

|rpm-ostree
|`packaging/ostree/svalinn-vault.rpm-ostree.yaml`

|Android
|`packaging/android/build.gradle.kts`

|Nix
|`flake.nix`

|Guix
|`guix.scm`
|===

== Security Tools & Validation

[cols="1,2"]
|===
|Tool |Purpose

|*Echidna*
|Formal verification of security properties

|*CodeQL*
|Static analysis

|*cargo-audit* / *cargo-deny*
|Dependency vulnerability scanning

|*Trivy*
|Container image scanning

|*TruffleHog* / *Gitleaks*
|Secret scanning

|*SBOM (CycloneDX)*
|Software bill of materials
|===

== QRNG (Quantum Random Number Generator)

[cols="1,2"]
|===
|Component |Details

|*Source*
|ANU Quantum Random Numbers

|*Endpoint*
|`https://qrng.anu.edu.au/API/jsonI.php`

|*Features*
|Decoy calls (30% probability), packet splitting (3-7 fragments)

|*Fallback*
|Hardware RNG (`/dev/urandom`)

|*Cache*
|1024 bytes local buffer
|===

== Authentication

[cols="1,2"]
|===
|Method |Implementation

|*Password*
|Argon2id (64 MiB, 4 iterations)

|*TOTP*
|RFC 6238, SHA-256, 6 digits, 30s period

|*Anti-AI CAPTCHA*
|Post-quantum visual challenges

|*Rate Limiting*
|10/min, lockout after 5 failures

|*Variable Delay*
|500-3000ms random delay
|===

== Version Control & CI/CD

[cols="1,2"]
|===
|Requirement |Enforcement

|*Signed Commits*
|GPG or SSH signatures required

|*Branch Protection*
|No force push, 2 reviewer minimum

|*Required Checks*
|CodeQL, cargo-audit, cargo-deny, Trivy

|*Lockdown Workflow*
|`.github/workflows/lockdown.yml`

|*Security Workflow*
|`.github/workflows/security.yml`
|===

== Declarative Configuration Trinity

[cols="1,3"]
|===
|File |Purpose

|*Mustfile*
|Mandatory requirements (security policies, algorithms, permissions)

|*Justfile*
|Task automation (build, test, deploy, lockdown)

|*config.nickel*
|Runtime configuration (crypto params, network, storage)
|===

== File Formats

[cols="1,2,2"]
|===
|Format |Used For |NOT Used

|S-expressions (Scheme)
|All data storage
|—

|AsciiDoc (.adoc)
|Documentation
|Markdown (except GitHub requirements)

|Nickel (.ncl)
|Configuration
|YAML, TOML (avoided)

|LaTeX (.tex)
|Whitepaper
|—

|—
|—
|JSON (avoided), XML (banned)
|===

== Directory Structure

[source]
----
reasonable-good-token-vault/
├── vault-core-ats/          # ATS core implementation
│   ├── SATS/                # Static specifications (types)
│   ├── DATS/                # Dynamic implementations
│   ├── HATS/                # Header files
│   └── zig/                 # Zig crypto bindings
├── network/
│   ├── cadre-router/        # LAN routing protection
│   ├── airvpn/              # VPN configuration
│   └── ipv6-coalesce/       # Idris2 packet handling
├── container/
│   ├── svalinn.containerfile
│   └── config/              # SELinux, firewalld
├── database/
│   ├── cubs/                # Primary store config
│   └── xtdb-search/         # Search index config
├── packaging/               # All distribution packages
├── docs/
│   ├── whitepaper/          # arXiv paper
│   └── wikidata/            # Wikidata entry draft
├── site/                    # ddraig-ssg promotional site
├── validation/              # Echidna formal verification
├── security/                # Hardening configs
├── honeypot/                # IPv4 honeypot scripts
├── USERMEMORY.scm           # Scheme identity registry
├── config.nickel            # Main configuration
├── Mustfile                 # Requirements specification
├── Justfile                 # Task automation
├── flake.nix                # Nix package
└── guix.scm                 # Guix package
----
